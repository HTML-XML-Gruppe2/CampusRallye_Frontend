<!DOCTYPE html>
<html lang="en">

<head>
  <!-- https://www.w3schools.com/bootstrap/tryit.asp?filename=trybs_temp_webpage&stacked=h -->
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- https://stackoverflow.com/questions/15878377/html5-responsive-canvas-resizing-the-browser-canvas-draw-disappear -->
  <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
  <link rel="stylesheet" href="Map.css">
</head>

<body>

  <nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"></a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#">About</a></li>
          <li><a href="#">Projects</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid text-center">
    <div class="row content">

      <div class="col-sm-8 text-left">
        <canvas id="Canvas"></canvas>
        <script>
          window.addEventListener("resize", handleResize);
          function handleResize() {
            canvas.width = window.innerWidth * 0.97;
            canvas.height = canvas.width * 0.6;
          }
          function onPinch(event) {
              var dist = getPinchDistance(event)
              // save the canvas content as imageURL
              var data = canvas.toDataURL();

              // resize the canvas
              canvas.width *= dist;
              canvas.height *= dist;

              // scale and redraw the canvas content
              var img = new Image();
              img.onload = function () {
                canvas.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);
              }
              img.src = data;

            }

          // window.addEventListener("mousewheel", onMouseWheel, false);
          // function saveResizeAndRedisplay(scaleFactor) {

          //   // save the canvas content as imageURL
          //   var data = canvas.toDataURL();

          //   // resize the canvas
          //   canvas.width *= scaleFactor;
          //   canvas.height *= scaleFactor;

          //   // scale and redraw the canvas content
          //   var img = new Image();
          //   img.onload = function () {
          //     canvas.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);
          //   }
          //   img.src = data;

          // }

          var canvas = document.getElementById('Canvas');
          var context = canvas.getContext("2d");
          canvas.width = window.innerWidth * 0.97;
          canvas.height = canvas.width * 0.6;
          // Map sprite
          var mapSprite = new Image();
          mapSprite.src = "map.jpg";

          //Knapheidesi hier muss abgefragt werden ob schon bearbeitet, oder wo anders einbinden, dass Bild geändert werden kann
          var Marker = function () {
            this.Sprite = new Image();
            this.Sprite.src = "http://www.clker.com/cliparts/w/O/e/P/x/i/map-marker-hi.png"
            this.Width = 12;
            this.Height = 20;
            this.XPos = 0;
            this.YPos = 0;
          }
          //Knapheidesi hier muss abgefragt werden ob schon bearbeitet, oder wo anders einbinden, dass Bild geändert werden kann

          var Markers = new Array();

          //Knapheidesi auskommentiert benötigt für den Admin Modus
          // var mouseClicked = function (mouse) {
          //     // Get corrent mouse coords
          //     var rect = canvas.getBoundingClientRect();
          //     var mouseXPos = (mouse.x - rect.left);
          //     var mouseYPos = (mouse.y - rect.top);

          //     console.log("Marker added");

          //     // Move the marker when placed to a better location
          //     var marker = new Marker();
          //     marker.XPos = mouseXPos - (marker.Width / 2);
          //     marker.YPos = mouseYPos - marker.Height;

          //     Markers.push(marker);
          // }

          // Add mouse click event listener to canvas
          // canvas.addEventListener("mousedown", mouseClicked, false);
          //Knapheidesi auskommentiert benötigt für den Admin Modus

          //Knapheidesi Aufbau der Pins auf der Karte muss aus Object ausgelesen werden
          var marker = new Marker();
          var rect = canvas.getBoundingClientRect();
          marker.XPos = 560 - rect.left;
          marker.YPos = 264.599998474 - rect.top;

          Markers.push(marker);
          //Knapheidesi Aufbau der Pins auf der Karte

          var firstLoad = function () {
            context.font = "15px Georgia";
            context.textAlign = "center";
          }

          firstLoad();

          var main = function () {
            draw();
          };

          var draw = function () {
            // Clear Canvas
            context.fillStyle = "#000";
            // context.fillRect(0, 0, window.innerWidth, window.innerWidth* 0.6);

            context.fillRect(0, 0, canvas.width, canvas.height);

            // Draw map
            // Sprite, X location, Y location, Image width, Image height
            // You can leave the image height and width off, if you do it will draw the image at default size
            context.drawImage(mapSprite, 0, 0, canvas.width, canvas.height);

            // Draw markers
            for (var i = 0; i < Markers.length; i++) {
              var tempMarker = Markers[i];
              // Draw marker
              context.drawImage(tempMarker.Sprite, tempMarker.XPos, tempMarker.YPos, tempMarker.Width, tempMarker.Height);

              // Calculate postion text
              var markerText = "Postion (X:" + tempMarker.XPos + ", Y:" + tempMarker.YPos;

              // Draw a simple box so you can see the position
              var textMeasurements = context.measureText(markerText);
              context.fillStyle = "#666";
              context.globalAlpha = 0.7;
              context.fillRect(tempMarker.XPos - (textMeasurements.width / 2), tempMarker.YPos - 15, textMeasurements.width, 20);
              context.globalAlpha = 1;

              // Draw position above
              context.fillStyle = "#000";
              context.fillText(markerText, tempMarker.XPos, tempMarker.YPos);
            }
          };

          setInterval(main, (1000 / 60)); // Refresh 60 times a second


        </script> 
      </div>
    </div>
  </div>

  <footer class="container-fluid text-center">
    <p>Footer Text</p>
  </footer>

</body>

</html>